@isTest
global class CalendarMockHttpResponseGenerator implements HttpCalloutMock {
    
    global HTTPResponse respond(HTTPRequest req) {
        string year  = '2020';
        calendarific_key__mdt calendarific = [SELECT api_key__c from calendarific_key__mdt where MasterLabel = 'gmineroskey'];
        // send a mock response for a specific endpoint and method.
        System.assertEquals('https://calendarific.com/api/v2/holidays?api_key='+calendarific.api_key__c+'&country=CA&type=national&year='+year, req.getEndpoint());
        System.assertEquals('GET', req.getMethod());
        
        // Mock tefake response
        HttpResponse res = new HttpResponse();
        res.setHeader('Content-Type', 'application/json');
        res.setBody('{"meta":{"code":200},"response":{"holidays":[{"name":"New Year\'s Day","description":"New Year\'s Day is the first day of a new year according to the Gregorian calendar used in Canada and many other countries.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-01-01","datetime":{"year":2020,"month":1,"day":1}},"type":["National holiday"],"locations":"All","states":"All"},{"name":"Good Friday","description":"On Good Friday, Christians commemorate the crucifixion of Jesus Christ and it is a statutory holiday in many parts of Canada.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-04-10","datetime":{"year":2020,"month":4,"day":10}},"type":["National holiday","Christian"],"locations":"All","states":"All"},{"name":"Easter Monday","description":"Easter Monday is the day after Easter Sunday and a holiday for many Canadians.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-04-13","datetime":{"year":2020,"month":4,"day":13}},"type":["National holiday"],"locations":"NB, NT, NU, QC","states":[{"id":60,"abbrev":"NB","name":"New Brunswick","exception":null,"iso":"ca-nb"},{"id":62,"abbrev":"NT","name":"Northwest Territories","exception":null,"iso":"ca-nt"},{"id":64,"abbrev":"NU","name":"Nunavut","exception":null,"iso":"ca-nu"},{"id":67,"abbrev":"QC","name":"Quebec","exception":null,"iso":"ca-qc"}]},{"name":"Victoria Day","description":"Victoria Day is celebrated in honor of the birthdays of both Queen Victoria and the current monarch of Canada.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-05-18","datetime":{"year":2020,"month":5,"day":18}},"type":["National holiday"],"locations":"All except NS, PE, QC","states":[{"id":57,"abbrev":"AB","name":"Alberta","exception":null,"iso":"ca-ab"},{"id":58,"abbrev":"BC","name":"British Columbia","exception":null,"iso":"ca-bc"},{"id":59,"abbrev":"MB","name":"Manitoba","exception":null,"iso":"ca-mb"},{"id":60,"abbrev":"NB","name":"New Brunswick","exception":null,"iso":"ca-nb"},{"id":61,"abbrev":"NL","name":"Newfoundland and Labrador","exception":null,"iso":"ca-nl"},{"id":62,"abbrev":"NT","name":"Northwest Territories","exception":null,"iso":"ca-nt"},{"id":64,"abbrev":"NU","name":"Nunavut","exception":null,"iso":"ca-nu"},{"id":65,"abbrev":"ON","name":"Ontario","exception":null,"iso":"ca-on"},{"id":68,"abbrev":"SK","name":"Saskatchewan","exception":null,"iso":"ca-sk"},{"id":69,"abbrev":"YT","name":"Yukon","exception":null,"iso":"ca-yt"}]},{"name":"Canada Day","description":"Canada Day is a federal holiday on July 1 to mark the anniversary of the date that Canada became a self-governing country.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-07-01","datetime":{"year":2020,"month":7,"day":1}},"type":["National holiday"],"locations":"All","states":"All"},{"name":"Labour Day","description":"Labour Day in Canada is a holiday to campaign for workers\' rights. It celebrates the achievements of these rights.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-09-07","datetime":{"year":2020,"month":9,"day":7}},"type":["National holiday"],"locations":"All","states":"All"},{"name":"Thanksgiving Day","description":"Thanksgiving Day is a holiday to give thanks for the blessings in one\'s life, particularly the harvest. It is a day off work for many Canadians.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-10-12","datetime":{"year":2020,"month":10,"day":12}},"type":["National holiday"],"locations":"All except NB, NS, PE","states":[{"id":57,"abbrev":"AB","name":"Alberta","exception":null,"iso":"ca-ab"},{"id":58,"abbrev":"BC","name":"British Columbia","exception":null,"iso":"ca-bc"},{"id":59,"abbrev":"MB","name":"Manitoba","exception":null,"iso":"ca-mb"},{"id":61,"abbrev":"NL","name":"Newfoundland and Labrador","exception":null,"iso":"ca-nl"},{"id":62,"abbrev":"NT","name":"Northwest Territories","exception":null,"iso":"ca-nt"},{"id":64,"abbrev":"NU","name":"Nunavut","exception":null,"iso":"ca-nu"},{"id":65,"abbrev":"ON","name":"Ontario","exception":null,"iso":"ca-on"},{"id":67,"abbrev":"QC","name":"Quebec","exception":null,"iso":"ca-qc"},{"id":68,"abbrev":"SK","name":"Saskatchewan","exception":null,"iso":"ca-sk"},{"id":69,"abbrev":"YT","name":"Yukon","exception":null,"iso":"ca-yt"}]},{"name":"Remembrance Day","description":"Remembrance Day commemorates civilians and military personnel who lost their lives in armed conflicts.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-11-11","datetime":{"year":2020,"month":11,"day":11}},"type":["National holiday"],"locations":"All except MB, NS, ON, QC","states":[{"id":57,"abbrev":"AB","name":"Alberta","exception":null,"iso":"ca-ab"},{"id":58,"abbrev":"BC","name":"British Columbia","exception":null,"iso":"ca-bc"},{"id":60,"abbrev":"NB","name":"New Brunswick","exception":null,"iso":"ca-nb"},{"id":61,"abbrev":"NL","name":"Newfoundland and Labrador","exception":null,"iso":"ca-nl"},{"id":62,"abbrev":"NT","name":"Northwest Territories","exception":null,"iso":"ca-nt"},{"id":64,"abbrev":"NU","name":"Nunavut","exception":null,"iso":"ca-nu"},{"id":66,"abbrev":"PE","name":"Prince Edward Island","exception":null,"iso":"ca-pe"},{"id":68,"abbrev":"SK","name":"Saskatchewan","exception":null,"iso":"ca-sk"},{"id":69,"abbrev":"YT","name":"Yukon","exception":null,"iso":"ca-yt"}]},{"name":"Christmas Day","description":"Christians celebrate the birth of Jesus Christ on Christmas Day in Canada.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-12-25","datetime":{"year":2020,"month":12,"day":25}},"type":["National holiday","Christian"],"locations":"All","states":"All"},{"name":"Boxing Day","description":"The day after Christmas Day is known as Boxing Day and is a holiday in many parts of Canada.","country":{"id":"ca","name":"Canada"},"date":{"iso":"2020-12-26","datetime":{"year":2020,"month":12,"day":26}},"type":["National holiday"],"locations":"NB, NL, NT, NU, ON","states":[{"id":60,"abbrev":"NB","name":"New Brunswick","exception":null,"iso":"ca-nb"},{"id":61,"abbrev":"NL","name":"Newfoundland and Labrador","exception":null,"iso":"ca-nl"},{"id":62,"abbrev":"NT","name":"Northwest Territories","exception":null,"iso":"ca-nt"},{"id":64,"abbrev":"NU","name":"Nunavut","exception":null,"iso":"ca-nu"},{"id":65,"abbrev":"ON","name":"Ontario","exception":null,"iso":"ca-on"}]}]}}');
        res.setStatusCode(200);
        return res;
    }
}
